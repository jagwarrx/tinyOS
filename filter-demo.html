<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Collapsible Filter Bar Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            slate: {
              850: '#1a1f2e',
              950: '#0f1419'
            }
          }
        }
      }
    }
  </script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
    }
  </style>
</head>
<body class="bg-white text-gray-900">
  <div id="root"></div>

  <script type="module">
    import { html, render, useState } from 'https://esm.sh/htm/preact/standalone'

    // Lucide icons as SVG
    const Brain = ({ size = 16, strokeWidth = 2, className = '' }) => html`
      <svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${strokeWidth}" stroke-linecap="round" stroke-linejoin="round" class="${className}">
        <path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"></path>
        <path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"></path>
        <path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"></path>
        <path d="M17.599 6.5a3 3 0 0 0 .399-1.375"></path>
        <path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"></path>
        <path d="M3.477 10.896a4 4 0 0 1 .585-.396"></path>
        <path d="M19.938 10.5a4 4 0 0 1 .585.396"></path>
        <path d="M6 18a4 4 0 0 1-1.967-.516"></path>
        <path d="M19.967 17.484A4 4 0 0 1 18 18"></path>
      </svg>
    `

    const Zap = ({ size = 16, strokeWidth = 2 }) => html`
      <svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${strokeWidth}" stroke-linecap="round" stroke-linejoin="round">
        <path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"></path>
      </svg>
    `

    const Wrench = ({ size = 16, strokeWidth = 2 }) => html`
      <svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${strokeWidth}" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
      </svg>
    `

    const Users = ({ size = 16, strokeWidth = 2 }) => html`
      <svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${strokeWidth}" stroke-linecap="round" stroke-linejoin="round">
        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </svg>
    `

    const Compass = ({ size = 16, strokeWidth = 2 }) => html`
      <svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${strokeWidth}" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon>
      </svg>
    `

    const Inbox = ({ size = 16, strokeWidth = 2 }) => html`
      <svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${strokeWidth}" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="22 12 16 12 14 15 10 15 8 12 2 12"></polyline>
        <path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path>
      </svg>
    `

    const Calendar = ({ size = 16, strokeWidth = 2 }) => html`
      <svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${strokeWidth}" stroke-linecap="round" stroke-linejoin="round">
        <path d="M8 2v4"></path>
        <path d="M16 2v4"></path>
        <rect width="18" height="18" x="3" y="4" rx="2"></rect>
        <path d="M3 10h18"></path>
      </svg>
    `

    const Play = ({ size = 16, strokeWidth = 2 }) => html`
      <svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${strokeWidth}" stroke-linecap="round" stroke-linejoin="round">
        <polygon points="6 3 20 12 6 21 6 3"></polygon>
      </svg>
    `

    const AlertCircle = ({ size = 16, strokeWidth = 2 }) => html`
      <svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${strokeWidth}" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" x2="12" y1="8" y2="12"></line>
        <line x1="12" x2="12.01" y1="16" y2="16"></line>
      </svg>
    `

    const CheckCircle2 = ({ size = 16, strokeWidth = 2 }) => html`
      <svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${strokeWidth}" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <path d="m9 12 2 2 4-4"></path>
      </svg>
    `

    const XCircle = ({ size = 16, strokeWidth = 2 }) => html`
      <svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${strokeWidth}" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <path d="m15 9-6 6"></path>
        <path d="m9 9 6 6"></path>
      </svg>
    `

    const ChevronRight = ({ size = 16 }) => html`
      <svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="m9 18 6-6-6-6"></path>
      </svg>
    `

    const ChevronLeft = ({ size = 16 }) => html`
      <svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="m15 18-6-6 6-6"></path>
      </svg>
    `

    const CollapsibleFilterBar = ({ selectedTaskType, selectedStatuses, onTaskTypeChange, onStatusChange }) => {
      const [isTaskTypeExpanded, setIsTaskTypeExpanded] = useState(false)
      const [isStatusExpanded, setIsStatusExpanded] = useState(false)

      const taskTypeOptions = [
        { value: 'DEEP_WORK', label: 'Deep Work', icon: Brain },
        { value: 'QUICK_WINS', label: 'Quick Wins', icon: Zap },
        { value: 'GRUNT_WORK', label: 'Grunt Work', icon: Wrench },
        { value: 'PEOPLE_TIME', label: 'People Time', icon: Users },
        { value: 'STRATEGIC', label: 'Strategic', icon: Compass }
      ]

      const statusOptions = [
        { value: 'BACKLOG', label: 'Backlog', icon: Inbox, color: 'gray' },
        { value: 'PLANNED', label: 'Planned', icon: Calendar, color: 'gray' },
        { value: 'DOING', label: 'Doing', icon: Play, color: 'gray' },
        { value: 'BLOCKED', label: 'Blocked', icon: AlertCircle, color: 'amber' }
      ]

      const handleTaskTypeToggle = (value) => {
        if (selectedTaskType === value) {
          onTaskTypeChange(null)
        } else {
          onTaskTypeChange(value)
        }
      }

      const handleStatusToggle = (value) => {
        const newSelected = selectedStatuses.includes(value)
          ? selectedStatuses.filter(s => s !== value)
          : [...selectedStatuses, value]
        onStatusChange(newSelected)
      }

      const getStatusColorClasses = (color, isActive) => {
        if (!isActive) {
          return 'text-gray-400 hover:text-gray-600'
        }

        switch (color) {
          case 'amber':
            return 'bg-yellow-500/20 text-yellow-600'
          case 'green':
            return 'bg-green-500/20 text-green-600'
          case 'gray':
            return 'bg-gray-500/20 text-gray-600'
          default:
            return 'text-gray-400'
        }
      }

      return html`
        <div class="space-y-3 p-3 bg-gray-50 border-b border-gray-200">
          <!-- Task Type Filter Bar -->
          <div class="flex items-center gap-2">
            <span class="text-xs font-medium text-gray-500 mr-2">Type</span>

            <div class="${'flex items-center gap-2 rounded-lg border transition-all duration-200 bg-white border-gray-200 ' +
              (isTaskTypeExpanded ? 'px-3 py-2' : 'px-2 py-1.5')}">
              ${taskTypeOptions.map(({ value, label, icon: Icon }) => {
                const isActive = selectedTaskType === value
                return html`
                  <button
                    key="${value}"
                    onClick=${() => handleTaskTypeToggle(value)}
                    class="${'flex items-center gap-1.5 rounded transition-all duration-200 ' +
                      (isTaskTypeExpanded ? 'px-2 py-1' : 'p-1.5') + ' ' +
                      (isActive
                        ? 'bg-blue-500/20 text-blue-500'
                        : 'text-gray-400 hover:text-gray-600')}"
                    title="${!isTaskTypeExpanded ? label : ''}"
                  >
                    <${Icon} size=${14} strokeWidth=${isActive ? 2.5 : 2} />
                    <span class="${'text-xs font-medium whitespace-nowrap overflow-hidden transition-all duration-200 ' +
                      (isTaskTypeExpanded ? 'max-w-[120px] opacity-100' : 'max-w-0 opacity-0')}">
                      ${label}
                    </span>
                  </button>
                `
              })}

              <div class="w-px h-4 bg-gray-200 mx-1" />

              <button
                onClick=${() => setIsTaskTypeExpanded(!isTaskTypeExpanded)}
                class="p-1 rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors"
                title="${isTaskTypeExpanded ? 'Collapse' : 'Expand'}"
              >
                ${isTaskTypeExpanded ? html`<${ChevronLeft} size=${12} />` : html`<${ChevronRight} size=${12} />`}
              </button>
            </div>
          </div>

          <!-- Status Filter Bar -->
          <div class="flex items-center gap-2">
            <span class="text-xs font-medium text-gray-500 mr-2">Status</span>

            <div class="${'flex items-center gap-2 rounded-lg border transition-all duration-200 bg-white border-gray-200 ' +
              (isStatusExpanded ? 'px-3 py-2' : 'px-2 py-1.5')}">
              ${statusOptions.map(({ value, label, icon: Icon, color }) => {
                const isActive = selectedStatuses.includes(value)
                return html`
                  <button
                    key="${value}"
                    onClick=${() => handleStatusToggle(value)}
                    class="${'flex items-center gap-1.5 rounded transition-all duration-200 ' +
                      (isStatusExpanded ? 'px-2 py-1' : 'p-1.5') + ' ' +
                      getStatusColorClasses(color, isActive)}"
                    title="${!isStatusExpanded ? label : ''}"
                  >
                    <${Icon} size=${14} strokeWidth=${isActive ? 2.5 : 2} />
                    <span class="${'text-xs font-medium whitespace-nowrap overflow-hidden transition-all duration-200 ' +
                      (isStatusExpanded ? 'max-w-[120px] opacity-100' : 'max-w-0 opacity-0')}">
                      ${label}
                    </span>
                  </button>
                `
              })}

              <div class="w-px h-4 bg-gray-200 mx-1" />

              <button
                onClick=${() => setIsStatusExpanded(!isStatusExpanded)}
                class="p-1 rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors"
                title="${isStatusExpanded ? 'Collapse' : 'Expand'}"
              >
                ${isStatusExpanded ? html`<${ChevronLeft} size=${12} />` : html`<${ChevronRight} size=${12} />`}
              </button>
            </div>
          </div>

          <!-- Clear Filters Button -->
          ${(selectedTaskType || selectedStatuses.length > 0) && html`
            <div class="flex justify-end pt-1">
              <button
                onClick=${() => {
                  onTaskTypeChange(null)
                  onStatusChange([])
                }}
                class="text-xs text-slate-400 hover:text-slate-300 transition-colors"
              >
                Clear all filters
              </button>
            </div>
          `}
        </div>
      `
    }

    const App = () => {
      const [selectedTaskType, setSelectedTaskType] = useState(null)
      const [selectedStatuses, setSelectedStatuses] = useState([])

      const mockTasks = [
        { id: 1, text: 'Implement authentication system', type: 'DEEP_WORK', status: 'DOING' },
        { id: 2, text: 'Fix typo in README', type: 'QUICK_WINS', status: 'DONE' },
        { id: 3, text: 'Review pull requests', type: 'PEOPLE_TIME', status: 'PLANNED' },
        { id: 4, text: 'Update dependencies', type: 'GRUNT_WORK', status: 'BACKLOG' },
        { id: 5, text: 'Plan Q1 roadmap', type: 'STRATEGIC', status: 'PLANNED' },
        { id: 6, text: 'Debug production issue', type: 'DEEP_WORK', status: 'BLOCKED' },
        { id: 7, text: 'Archive old projects', type: 'GRUNT_WORK', status: 'CANCELLED' }
      ]

      const filteredTasks = mockTasks.filter(task => {
        const matchesType = !selectedTaskType || task.type === selectedTaskType
        const matchesStatus = selectedStatuses.length === 0 || selectedStatuses.includes(task.status)
        return matchesType && matchesStatus
      })

      const getStatusBadgeColor = (status) => {
        switch (status) {
          case 'DOING': return 'bg-blue-500/20 text-blue-400 border-blue-500/50'
          case 'DONE': return 'bg-green-500/20 text-green-400 border-green-500/50'
          case 'BLOCKED': return 'bg-amber-500/20 text-amber-400 border-amber-500/50'
          case 'PLANNED': return 'bg-purple-500/20 text-purple-400 border-purple-500/50'
          case 'BACKLOG': return 'bg-gray-500/20 text-gray-400 border-gray-500/50'
          case 'CANCELLED': return 'bg-red-500/20 text-red-400 border-red-500/50'
          default: return 'bg-slate-600/20 text-slate-400 border-slate-600/50'
        }
      }

      return html`
        <div class="min-h-screen bg-white">
          <!-- Header -->
          <div class="bg-white border-b border-gray-200 p-6">
            <h1 class="text-2xl font-bold text-gray-900 mb-2">Collapsible Filter Bar Demo</h1>
            <p class="text-sm text-gray-600">
              Click the expand buttons (→) to see labels. Click icons to filter tasks.
            </p>
          </div>

          <!-- Filter Bar -->
          <${CollapsibleFilterBar}
            selectedTaskType=${selectedTaskType}
            selectedStatuses=${selectedStatuses}
            onTaskTypeChange=${setSelectedTaskType}
            onStatusChange=${setSelectedStatuses}
          />

          <!-- Content -->
          <div class="p-6 bg-gray-50">
            <div class="mb-6">
              <h2 class="text-lg font-semibold text-gray-800 mb-3">
                Filtered Tasks (${filteredTasks.length} of ${mockTasks.length})
              </h2>

              ${filteredTasks.length === 0 ? html`
                <div class="text-center py-12 bg-white rounded-lg border border-gray-200">
                  <p class="text-gray-500">No tasks match the selected filters</p>
                </div>
              ` : html`
                <div class="space-y-2">
                  ${filteredTasks.map(task => html`
                    <div key="${task.id}" class="p-4 bg-white rounded-lg border border-gray-200 hover:border-gray-300 transition-colors">
                      <p class="text-gray-800 mb-2">${task.text}</p>
                      <div class="flex items-center gap-2">
                        <span class="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded">
                          ${task.type.replace(/_/g, ' ')}
                        </span>
                        <span class="${'text-xs px-2 py-1 border rounded ' + getStatusBadgeColor(task.status)}">
                          ${task.status}
                        </span>
                      </div>
                    </div>
                  `)}
                </div>
              `}
            </div>
          </div>
        </div>
      `
    }

    render(html`<${App} />`, document.getElementById('root'))
  </script>
</body>
</html>
